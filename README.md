# ê·¸ë§Œì˜ ì•„ì¹¨í¸ì§€ v2

> ìŠ¤íƒ€íŠ¸ì—… ì°½ì—…ê°€ë¥¼ ìœ„í•œ ì¼ì¼ ë‰´ìŠ¤ë ˆí„° í”Œë«í¼ (ë¦¬ë‰´ì–¼ ë²„ì „)

## ğŸ—ï¸ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Frontend                              â”‚
â”‚                    (Next.js + Vercel)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ë©”ì¸   â”‚ â”‚ ì•„ì¹´ì´ë¸Œ â”‚ â”‚  í¸ì§€   â”‚ â”‚  ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ  â”‚   â”‚
â”‚  â”‚ í˜ì´ì§€  â”‚ â”‚  í˜ì´ì§€  â”‚ â”‚ ìƒì„¸    â”‚ â”‚  + ì—ë””í„°        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚ API Calls
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Backend                               â”‚
â”‚                (Hono + Cloudflare Workers)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚Newsletterâ”‚ â”‚   News   â”‚ â”‚Subscriberâ”‚ â”‚    AI    â”‚       â”‚
â”‚  â”‚   API    â”‚ â”‚   API    â”‚ â”‚   API    â”‚ â”‚   API    â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                 â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Supabase   â”‚  â”‚ Cloudflare   â”‚  â”‚   Stibee     â”‚
â”‚  (PostgreSQL â”‚  â”‚     R2       â”‚  â”‚  (ì´ë©”ì¼)    â”‚
â”‚   + Auth)    â”‚  â”‚  (ì´ë¯¸ì§€)    â”‚  â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âœ… ì™„ë£Œëœ ê¸°ëŠ¥

### Stibee ì´ë©”ì¼ ì—°ë™ (2025-11-30)
- **êµ¬ë…ì ê´€ë¦¬**
  - ì‹ ê·œ êµ¬ë… ì‹œ ìë™ Stibee ë™ê¸°í™”
  - êµ¬ë… ì·¨ì†Œ ì‹œ Stibee ì—°ë™
  - `/api/subscribers/sync-stibee` - ì „ì²´ êµ¬ë…ì ì¼ê´„ ë™ê¸°í™”
  - `/api/subscribers/import-stibee` - Stibeeì—ì„œ êµ¬ë…ì ê°€ì ¸ì˜¤ê¸°

- **ë‰´ìŠ¤ë ˆí„° ë°œì†¡**
  - `POST /api/newsletters/:id/send` - Stibee APIë¡œ ë‰´ìŠ¤ë ˆí„° ë°œì†¡
  - `POST /api/newsletters/:id/send-test` - í…ŒìŠ¤íŠ¸ ì´ë©”ì¼ ë°œì†¡
  - `GET /api/newsletters/:id/preview` - ì´ë©”ì¼ HTML ë¯¸ë¦¬ë³´ê¸°
  - `GET /api/newsletters/stibee/status` - Stibee ì„¤ì • ìƒíƒœ í™•ì¸

- **ì´ë©”ì¼ í…œí”Œë¦¿**
  - ë°˜ì‘í˜• HTML ì´ë©”ì¼ í…œí”Œë¦¿
  - ë‰´ìŠ¤ ì•„ì´í…œ í¬í•¨ ë ˆì´ì•„ì›ƒ
  - íë ˆì´í„° ë…¸íŠ¸ ì„¹ì…˜
  - êµ¬ë… ì·¨ì†Œ ë§í¬

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
morning-letter-v2/
â”œâ”€â”€ backend/                 # Hono API (Cloudflare Workers)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ index.ts        # ë©”ì¸ ì•±
â”‚   â”‚   â”œâ”€â”€ routes/         # API ë¼ìš°íŠ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ newsletters.ts  # ë‰´ìŠ¤ë ˆí„° API + Stibee ë°œì†¡
â”‚   â”‚   â”‚   â”œâ”€â”€ subscribers.ts  # êµ¬ë…ì API + Stibee ë™ê¸°í™”
â”‚   â”‚   â”‚   â”œâ”€â”€ news.ts         # ë‰´ìŠ¤ API
â”‚   â”‚   â”‚   â”œâ”€â”€ ai.ts           # AI ì½˜í…ì¸  ìƒì„±
â”‚   â”‚   â”‚   â””â”€â”€ upload.ts       # ì´ë¯¸ì§€ ì—…ë¡œë“œ
â”‚   â”‚   â”œâ”€â”€ lib/            # ìœ í‹¸ë¦¬í‹°
â”‚   â”‚   â”‚   â”œâ”€â”€ stibee.ts       # Stibee API í´ë¼ì´ì–¸íŠ¸ âœ¨
â”‚   â”‚   â”‚   â”œâ”€â”€ supabase.ts     # Supabase í´ë¼ì´ì–¸íŠ¸
â”‚   â”‚   â”‚   â””â”€â”€ errors.ts       # ì—ëŸ¬ ì²˜ë¦¬
â”‚   â”‚   â””â”€â”€ types/          # íƒ€ì… ì •ì˜
â”‚   â”œâ”€â”€ wrangler.toml
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ frontend/               # Next.js (Vercel)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ app/           # App Router
â”‚   â”‚   â”œâ”€â”€ components/    # UI ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â””â”€â”€ lib/           # ìœ í‹¸ë¦¬í‹°
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ HANDOFF.md              # ë°±ì—”ë“œ ë¦¬ë‰´ì–¼ í•¸ë“œì˜¤í”„ ë¬¸ì„œ
â””â”€â”€ README.md
```

## ğŸ› ï¸ ê¸°ìˆ  ìŠ¤íƒ

### Backend
- **Framework**: Hono (TypeScript)
- **Runtime**: Cloudflare Workers
- **Database**: Supabase (PostgreSQL)
- **Storage**: Cloudflare R2
- **Email**: Stibee API âœ¨
- **AI**: Gemini / OpenAI / Claude

### Frontend
- **Framework**: Next.js 14 (App Router)
- **Styling**: Tailwind CSS
- **State**: React Query (TanStack Query)
- **Auth**: Supabase Auth
- **Deployment**: Vercel

## ğŸ” í™˜ê²½ ë³€ìˆ˜

### Backend (.dev.vars)
```bash
# Supabase
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key

# Cloudflare R2
R2_PUBLIC_URL=https://your-bucket.r2.dev

# Stibee âœ¨
STIBEE_API_KEY=your-api-key
STIBEE_LIST_ID=449567
STIBEE_SENDER_EMAIL=letter4ceo@letter4ceo.com
# STIBEE_AUTO_EMAIL_URL=https://stibee.com/api/v1.0/auto/YOUR_ID (ì„ íƒ)

# AI
GEMINI_API_KEY=your-key
OPENAI_API_KEY=your-key

# CORS
CORS_ORIGIN=http://localhost:3000
```

## ğŸš€ ê°œë°œ ì‹œì‘

### Backend
```bash
cd backend
npm install
npm run dev
# http://localhost:8787
```

### Frontend
```bash
cd frontend
npm install
npm run dev
# http://localhost:3000
```

## ğŸ“¡ API ì—”ë“œí¬ì¸íŠ¸

### ë‰´ìŠ¤ë ˆí„° API
| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| GET | `/api/newsletters` | ëª©ë¡ ì¡°íšŒ |
| GET | `/api/newsletters/:id` | ìƒì„¸ ì¡°íšŒ |
| POST | `/api/newsletters` | ìƒì„± |
| PUT | `/api/newsletters/:id` | ìˆ˜ì • |
| DELETE | `/api/newsletters/:id` | ì‚­ì œ |
| POST | `/api/newsletters/:id/send` | **Stibeeë¡œ ë°œì†¡** âœ¨ |
| POST | `/api/newsletters/:id/send-test` | í…ŒìŠ¤íŠ¸ ë°œì†¡ |
| GET | `/api/newsletters/:id/preview` | HTML ë¯¸ë¦¬ë³´ê¸° |
| POST | `/api/newsletters/:id/schedule` | ì˜ˆì•½ ë°œì†¡ |
| GET | `/api/newsletters/stibee/status` | Stibee ìƒíƒœ í™•ì¸ |

### êµ¬ë…ì API
| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| GET | `/api/subscribers` | ëª©ë¡ ì¡°íšŒ |
| POST | `/api/subscribers/subscribe` | êµ¬ë… (+ Stibee ë™ê¸°í™”) âœ¨ |
| POST | `/api/subscribers/unsubscribe` | êµ¬ë… ì·¨ì†Œ (+ Stibee) âœ¨ |
| POST | `/api/subscribers/sync-stibee` | **ì „ì²´ Stibee ë™ê¸°í™”** âœ¨ |
| POST | `/api/subscribers/import-stibee` | Stibeeì—ì„œ ê°€ì ¸ì˜¤ê¸° |
| GET | `/api/subscribers/stats` | í†µê³„ |

### ë‰´ìŠ¤ API
| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| GET | `/api/news` | ëª©ë¡ ì¡°íšŒ |
| POST | `/api/news` | ìƒì„± |
| POST | `/api/news/:id/summarize` | AI ìš”ì•½ |

### AI API
| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| POST | `/api/ai/generate-letter` | ì•„ì¹¨í¸ì§€ ìƒì„± |
| POST | `/api/ai/summarize` | ë‰´ìŠ¤ ìš”ì•½ |

## ğŸ”— URLs

- **Supabase**: https://kvbksqlpwrypspojehlb.supabase.co
- **Stibee List ID**: 449567
- **Sender Email**: letter4ceo@letter4ceo.com

## ğŸ“‹ ë‹¤ìŒ ë‹¨ê³„

1. [ ] í”„ë¡ íŠ¸ì—”ë“œ ì¶”ê°€ í˜ì´ì§€ êµ¬í˜„ (`/archive`, `/letter/[id]`, `/admin`)
2. [ ] Supabase Auth ì—°ë™
3. [ ] Cloudflare Workers ë°°í¬
4. [ ] Vercel í”„ë¡ íŠ¸ì—”ë“œ ë°°í¬
5. [ ] ìë™ ì´ë©”ì¼ URL ì„¤ì • (STIBEE_AUTO_EMAIL_URL)

---

*ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: 2025-11-30*
